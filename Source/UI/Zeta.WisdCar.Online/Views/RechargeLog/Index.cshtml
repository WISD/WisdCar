<!-- BEGIN PAGE HEADER-->
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN PAGE TITLE & BREADCRUMB-->
        <h3 class="page-title">
            充值记录 <small>Recharge Log</small>
        </h3>
        <ul class="page-breadcrumb breadcrumb">
            <li>
                <i class="fa fa-home"></i>
                <a href="@Url.Action("Index", "Dashboard")">
                    首页
                </a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <a href="#">
                    充值消费
                </a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <a href="#">
                    充值记录
                </a>
            </li>
        </ul>
        <!-- END PAGE TITLE & BREADCRUMB-->
    </div>
</div>
<!-- END PAGE HEADER-->
<!-- BEGIN PAGE CONTENT-->
					<!-- 后台需要用的 开始-->
<div class="portlet box blue">
    <div class="portlet-title">
        <div class="caption">
            <i class="fa fa-globe"></i>充值记录
        </div>
    </div>


    <div class="portlet-body">

        <div class="portlet box" style="margin-bottom:10px; border:1px solid #bde9f1;">
            <div class="portlet-body">
                <form class="form-horizontal" id="formQuery">
                    <div class="form-group">
                        <label class="col-md-2 control-label" for="txtQyName">客户姓名:</label>
                        <div class="col-md-2">
                            <input type="text" id="txtQyName" name="Name" class="form-control" placeholder="">
                        </div>
                        <label class="col-md-2 control-label" for="txtQyCardNo">会员卡号:</label>
                        <div class="col-md-2">
                            <input type="text" id="txtQyCardNo" name="CardNo" class="form-control" placeholder="">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-2 control-label" for="txtQyDore">充值门店:</label>
                        <div class="col-md-2">
                            <input type="text" id="txtQyDore" name="Dore" class="form-control" placeholder="">
                        </div>
                        <label class="col-md-2 control-label" for="txtQyTime">充值时间:</label>
                        <div class="col-md-2">
                            <div class="input-group input-large date-picker input-daterange" data-date="10/11/2012" data-date-format="mm/dd/yyyy">
                                <input type="text" class="form-control" name="from">
                                <span class="input-group-addon" style="background:none; border:none;">
                                    至
                                </span>
                                <input type="text" class="form-control" name="to">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-2 control-label" for="txtQyOperator">操作人员:</label>
                        <div class="col-md-2">
                            <input type="text" id="txtQyOperator" name="Operator" class="form-control" placeholder="">
                        </div>

                        <div class="col-md-2">
                        </div>
                        <div class="col-md-2">
                            <button type="button" onclick="seachList()" class="btn blue"><i class="fa fa-search"></i> 查询</button>
                        </div>
                    </div>

                </form>
            </div>
        </div>

        <!--记录明细 开始 -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">记录明细:</h3>
            </div>
            <!-- tal切换开始 -->
            <div class="panel-body">
                <div class="portlet box ">

                    <div class="portlet-body">
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a href="#tab_1_1" data-toggle="tab" onclick="setWidth()">
                                    现金
                                </a>
                            </li>
                            <li>
                                <a href="#tab_1_2" data-toggle="tab" onclick="setWidth()">
                                    套餐
                                </a>
                            </li>

                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade active in" id="tab_1_1" style="width:100%">
                                <div class="portlet box" style="margin-bottom:10px; border:1px solid #bde9f1;">

                                    <div class="portlet-body">
                                        <table id="tblClientSide" class="display" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>充值订单号</th>
                                                    <th>会员卡号</th>
                                                    <th>客户姓名</th>
                                                    <th>充值门店</th>
                                                    <th>操作人员</th>
                                                    @*<th>充值类型</th>*@
                                                    <th>实收金额</th>
                                                    <th>入账金额</th>
                                                    <th>充值时间</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>


                            <div class="tab-pane fade" id="tab_1_2" style="width:100%">
                                <div class="portlet box" style="margin-bottom:10px; border:1px solid #bde9f1;">

                                    <div class="portlet-body">
                                        <table id="tblClientSides" class="display" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>充值订单号</th>
                                                    <th>会员卡号</th>
                                                    <th>客户姓名</th>
                                                    <th>充值门店</th>
                                                    <th>操作人员</th>
                                                    @*<th>充值类型</th>*@
                                                    <th>实收金额</th>
                                                    <th>入账金额</th>
                                                    <th>充值时间</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>



                        </div>

                    </div>
                </div>
            </div>
            <!-- tal切换结束 -->
        </div>
        <!--记录明细 结束 -->

    </div>

</div>
<!-- END PAGE CONTENT-->
@section styles{
    <link href="@Url.Content("~/assets/plugins/datatables/css/jquery.dataTables.css")" rel="stylesheet" />
}
@section scripts{
<script src="@Url.Content("~/assets/plugins/datatables/js/jquery.dataTables.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/assets/plugins/bootstrap-daterangepicker/moment.min.js")" type="text/javascript"></script>

<script>

    jQuery(document).ready(function () {
        App.init();
        AjaxDatatables.Init();
        ComponentsPickers.init();
    });
    var setWidth = function () {
        //$('.dataTables_scrollHeadInner').css('width', '100%');
        //$('.dataTables_scrollHead').css('display', 'none');
        //$("#tblClientSides").DataTable().search().draw();
       // $.fn.dataTable
       //.tables({ visible: true, api: true })
       //.columns.adjust();
    }
    var getRechargeList=function(){
        var data = {};
        var formdt = $("#formQuery").serializeArray();
        for (var e in formdt) {
            data[formdt[e].name] = formdt[e].value;
        }
        var resultData = [];
        $.ajax({
            "type": "post",
            "url": "@Url.Action("GetRechargeLogList", "RechargeLog")",
            "dataType": "json",
            "data":data,
            "async":false,
            "cache": false,
            "success": function (re) {
                if (re.Success)
                {
                    //$("#tblClubCard").dataTable().fnDraw();
                    resultData= re.Data;
                }
                else
                {
                    alert(re.Message);
                }
            },
            "error": function () {
                alert("网络错误，请稍后重试");
            }
        });
        return resultData;
    }
    var seachList = function () {
        AjaxDatatables.Reset();
    }
    var d = true;
    var formatDate= function(dt) {
        if (dt)
        {
            var now = dt.replace("/Date(", "").replace(")/", "");
            now = now * 1;
            var d = new Date(now);
            var year = d.getFullYear();
            var month = d.getMonth() + 1;
            var date = d.getDate();
            var hour = d.getHours();
            var minute = d.getMinutes();
            var second = d.getSeconds();
               
            return year + "/" + (month < 10 ? '0' + month : month) + "/" + (date < 10 ? '0' + date : date) + " " + (hour < 10 ? '0' + hour : hour) + ":" + (minute < 10 ? '0' + minute : minute) + ":" + (second < 10 ? '0' + second : second);
        } else {
            return null
        }
           
            
    }
    var clientSideTable, clientSideTables;
    var AjaxDatatables = function () {
        var onPageLoad = function OnPageLoad() {
            var data = getRechargeList() || null;
            var carshdata = [];
            var pkgdata = [];
            if (data) {
                $.each(data, function () {
                    this.RechargeDate = formatDate(this.RechargeDate);
                    if (this.RechargeType == 0) {
                        this.RechargeType = "现金充值";
                        carshdata.push(this);
                    } else if (this.RechargeType == 1) {
                        this.RechargeType = "套餐充值";
                        pkgdata.push(this);
                    }
                })
            }
            initClientSideTable(carshdata);
            initClientSideTables(pkgdata);
            //initChildRowsTable();
            //initServerSideTable();
        };

        var initClientSideTable = function (cdata) {
            clientSideTable = $("#tblClientSide").DataTable({
                "processing": false,
                "serverSide": false,
                "data":cdata,
                "columns": [
                    { "data": "RechargeSerialNo" },
                    { "data": "ClubCardNo" },
                    { "data": "CustName" },
                    { "data": "RechargeStore" },
                    { "data": "CreatorID" },
                    //{ "data": "RechargeType" },
                    { "data": "ActualRechargeAmount" },
                    { "data": "PlatformRechargeAmount" },
                    { "data": "RechargeDate" }
                ],
                "columnDefs": [
                    {
                        "targets": [0],
                        "visible": true,
                        "searchable": false
                    },
                    {
                        "targets": [3],
                        "orderable": false
                    }
                ],
                "bDestroy": true,
                "bAutoWidth": true,
                "order": [[7, "desc"]],
                "deferRender": true,
                "scrollX": true,
                "paging": true,
                "ordering": true,
                "info": true,
                "pagingType": "full_numbers",
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                "language": {
                    "emptyTable": "没有数据",
                    "loadingRecords": "加载中...",
                    "processing": "查询中...",
                    "search": "查询: ",
                    "lengthMenu": "显示_MENU_条",
                    "zeroRecords": "没有数据",
                    "paginate": {
                        "previous": "上一页",
                        "next": "下一页",
                        "first": "第一页",
                        "last": "最后一页"
                    },
                    "info": "显示_START_-_END_，共_TOTAL_条记录",
                    "infoEmpty": "0条记录",
                    "infoFiltered": "(查询前有_MAX_条记录)"
                }
            });
            if (d) {
                $("#tblClientSide tbody").on("click", "tr", function () {
                    if ($(this).hasClass('selected')) {
                        $(this).removeClass('selected');
                    }
                    else {
                        clientSideTable.$('tr.selected').removeClass('selected');
                        $(this).addClass('selected');
                    }
                });

                $("#tblClientSide_filter input").addClass("form-control input-medium input-inline");
                $("#tblClientSide_length select").addClass("form-control input-xsmall input-inline");
            }
            jQuery('#tblClientSide_filter').html('');
           
        };

        var initClientSideTables = function (pdata) {
             clientSideTables = $("#tblClientSides").DataTable({
                "processing": false,
                "serverSide": false,
                "data":pdata,
                "columns": [
                    { "data": "RechargeSerialNo" },
                    { "data": "ClubCardNo" },
                    { "data": "CustName" },
                    { "data": "RechargeStore" },
                    { "data": "CreatorID" },
                    //{ "data": "RechargeType" },
                    { "data": "ActualRechargeAmount" },
                    { "data": "PlatformRechargeAmount" },
                    { "data": "RechargeDate" }
                ],
                "columnDefs": [
                    {
                        "targets": [0],
                        "visible": true,
                        "searchable": false
                    },
                    {
                        "targets": [3],
                        "orderable": false
                    }
                ],
                "bDestroy": true,
                "bAutoWidth": true,
                "order": [[7, "desc"]],
                "deferRender": true,
                "scrollX": true,
                "paging": true,
                "ordering": true,
                "info": true,
                "pagingType": "full_numbers",
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                "language": {
                    "emptyTable": "没有数据",
                    "loadingRecords": "加载中...",
                    "processing": "查询中...",
                    "search": "查询: ",
                    "lengthMenu": "显示_MENU_条",
                    "zeroRecords": "没有数据",
                    "paginate": {
                        "previous": "上一页",
                        "next": "下一页",
                        "first": "第一页",
                        "last": "最后一页"
                    },
                    "info": "显示_START_-_END_，共_TOTAL_条记录",
                    "infoEmpty": "0条记录",
                    "infoFiltered": "(查询前有_MAX_条记录)"
                }
            });
             if (d) {
                 $("#tblClientSides tbody").on("click", "tr", function () {
                     if ($(this).hasClass('selected')) {
                         $(this).removeClass('selected');
                     }
                     else {
                         clientSideTables.$('tr.selected').removeClass('selected');
                         $(this).addClass('selected');
                     }
                 });

                 $("#tblClientSides_filter input").addClass("form-control input-medium input-inline");
                 $("#tblClientSides_length select").addClass("form-control input-xsmall input-inline");
             }
             jQuery('#tblClientSides_filter').html('');
             d = false;
            
        };
        var setTables = function () {
           
            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                var tbl = $.fn.dataTable.tables({ visible: true, api: true });
                   
                    tbl.columns.adjust();
            })
        }
        return {
            Init: function () {
                $("#sidebar_menu_recharge_consume").addClass("active");
                $("#sidebar_menu_recharge_log").addClass("active");
                App.blockUI({ boxed: true });
                onPageLoad();
                setTables();
                window.setTimeout(function () {
                    App.unblockUI();
                }, 1000);
            },
            Reset: function () {
                onPageLoad();
            }
        };
    }();
</script>
}